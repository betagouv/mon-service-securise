extends ../deuxColonnes
include ../carteInformations

mixin action({ description, url, statut })
  - let classeStyleStatut
  -
    switch(statut) {
      case InformationsHomologation.A_SAISIR: classeStyleStatut = 'a-faire'; break;
      case InformationsHomologation.A_COMPLETER: classeStyleStatut = 'a-completer'; break;
      case InformationsHomologation.COMPLETES: classeStyleStatut = 'faite'; break;
      default: '';
    }

  a.action(class = classeStyleStatut, href = url)= description


block append styles
  link(href = '/statique/assets/styles/homologation/synthese.css', rel = 'stylesheet')

block retour
  a(href = '/espacePersonnel') ‹&nbsp;&nbsp;Mon espace personnel

block zone-principale
  .details-service
    .tableau-bord
      .titre-service
        h1!= service.nomService()
      a.bouton(href = `/homologation/${service.id}/decision`) Télécharger la synthèse

    .actions
      ul
        each actionSaisie in actionsSaisie
          li
            +action(actionSaisie)

    .outils-complementaires
      h3 Outils complémentaires
      // vide pour l'instant

block cartes-informations
  - const indiceSecurite = service.indiceSecurite()
  - const indiceSecuriteMax = referentiel.indiceSecuriteMax()
  - const formatte = Intl.NumberFormat('fr', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format

  mixin detailsIndiceSecurite
    h3 Par catégorie de mesure
    dl
      each id in referentiel.identifiantsCategoriesMesures()
        dt= referentiel.descriptionCategorie(id)
        dd= (typeof indiceSecurite[id] === 'number' ? `${formatte(indiceSecurite[id])} / ${indiceSecuriteMax}` : '–')

    h3 À quoi sert l'indice de sécurité ?
    p.
      L'indice de sécurité fournit une indication du niveau de sécurité du
      service basée sur une évaluation de la conformité de ce dernier à un
      socle de mesures de sécurité personnalisé.
    p.
      Cette note ne constitue pas une preuve effective de la sécurité du
      service. MonServiceSécurisé et l'ANSSI ne peuvent en aucun cas être tenus
      responsables d'incidents de sécurité susceptibles d'affecter le service
      numérique, quelle que soit la note attribuée à ce dernier.

    p: a(href = '/questionsFrequentes#indice-securite', target = '_blank', rel = 'noopener').nouvel-onglet En savoir plus


  - const { total } = indiceSecurite
  if process.env.AVEC_INDICE_SECURITE && total > 0
    +carteInformations({ titre: 'Indice de sécurité', sousTitre: "Évalué par l'ANSSI", details: 'detailsIndiceSecurite' })
      .score-mss
        span.score= formatte(total)
        span.score-max= ` / ${indiceSecuriteMax}`
