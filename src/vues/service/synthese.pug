extends ../deuxColonnes
include ../cartes/indiceCyber
include ../cartes/recommandationsANSSI
include ../cartes/statutHomologation
include ../fragments/cartesInformations
include ../fragments/texteTronque

mixin action({ id, description, sousTitre, url, statut })
  a(href = url)
    .action(class = `${id}`)
      -
        const statutSaisie = (statut) => {
          switch (statut) {
            case InformationsHomologation.COMPLETES:
              return 'faite';
            case InformationsHomologation.A_COMPLETER:
              return 'en-cours';
            default:
              return '';
          }
        }
      .statut(class = statutSaisie(statut))
      div(class = `icone-action`)
      h2= description
      .sous-titre= sousTitre

mixin outilComplementaire({ id, nom, description, lien })
  .outil-complementaire(class = id)
    .titre-outil
      .icone-outil
      h3= nom
    .description #{description} #[a.avec-chevron(href = lien.url)= lien.texte]

block append styles
  link(href = '/statique/assets/styles/homologation/synthese.css', rel = 'stylesheet')

block retour
  nav.fil-ariane
    a.avec-chevron(href = '/tableauDeBord') Tableau de bord
    div: +texteTronque({ texte: service.nomService() })

block zone-principale
  .details-service
    h1.titre-service!= service.nomService()

    .actions
      each actionSaisie in actionsSaisie
        +action(actionSaisie)

    .cartes-outils-complementaires
      h2 Outils complémentaires
      .outils-complementaires
        +outilComplementaire({
          id: 'risques',
          nom: 'Risques',
          description: 'Cartographiez les impacts potentiels des risques de sécurité les plus courants.',
          lien: { url: `/service/${service.id}/risques`, texte: 'Remplir'}
        })
        +outilComplementaire({
          id: 'contactsUtiles',
          nom: 'Contacts utiles',
          description: 'Créez la liste des personne contribuant au fonctionnement du service à contacter en cas de besoin.',
          lien: { url: `/service/${service.id}/rolesResponsabilites`, texte: 'Compléter' }
        })

    .telechargement-pdfs
      a.bouton.nouvel-onglet(
        href = `/api/service/${service.id}/pdf/syntheseSecurite.pdf`,
        target = `blank`,
        rel = ``
      ) Télécharger la synthèse
      a.bouton.nouvel-onglet(
        href = `/api/service/${service.id}/pdf/annexes.pdf`,
        target = `blank`,
        rel = ``
      ) Télécharger les annexes

block cartes-informations
  +statutHomologation({ donneesStatutHomologation })

  - const indiceCyber = service.indiceCyber()
  +indiceCyber({ referentiel, indiceCyber })

  +recommandationsANSSI({ referentiel, noteObtenue: indiceCyber.total })